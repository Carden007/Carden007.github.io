<!doctype html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="人生有很多事情急不得，没有白走的路，走每一步都算数。">
<meta property="og:type" content="website">
<meta property="og:title" content="Carden&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Carden&#39;s Blog">
<meta property="og:description" content="人生有很多事情急不得，没有白走的路，走每一步都算数。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Carden&#39;s Blog">
<meta name="twitter:description" content="人生有很多事情急不得，没有白走的路，走每一步都算数。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Carden's Blog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Carden's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/09/函数编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Carden007">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://static.pexels.com/photos/33392/portrait-bird-nature-wild.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Carden's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/09/函数编程/" itemprop="url">函数编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-09T12:18:28+08:00">
                2017-06-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://upload-images.jianshu.io/upload_images/4651096-d5076bf6dc5e7170.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<blockquote>
<p>#最终诉求</p>
</blockquote>
<p>整理层次结构，一个理论一个demo，链式编程、响应式编程、RAC内部原理、编程思想、RAC梳理直播逻辑、锻炼头脑、帮助他人、深入浅出、swift基础。</p>
<blockquote>
<p>#Cocoa框架</p>
</blockquote>
<p>面向对象的框架，OC是面向对象的编程，本质上是对于c语言命令式编程的上层封装。</p>
<blockquote>
<p>#函数式编程Vs面向对象编程</p>
</blockquote>
<p>面向对象编程:指令式编程范畴。函数式编程: 语法趋向于数学公式的推导，代码执行顺序不重要，意味着轻松并发编程。响应式编程典型例子：Excel的一个单元格变化导致其它单元格立即变化。Autolayout的父视图frame变化，有约束关系的子视图frame随之变化。一切皆因变量之间存在着函数关系。</p>
<blockquote>
<p>#RAC改写登录注册</p>
</blockquote>
<p>登录service校验用户名和密码、登录按钮不可点击。防止用户多次登录。如果登录失败、用户尝试重新登录、隐藏错误信息。改变按钮状态、接收到next值信号、副作用操作。</p>
<blockquote>
<p>#高阶函数</p>
</blockquote>
<p>函数里面调用函数。在oc中，blocks是被广泛使用的参数传递，它实际上是匿名函数。像linux命令里的pipeline（管道），一个命令调用后的输出当作另一个命令的输入，多个命令串起来操作。</p>
<blockquote>
<p>#链式编程</p>
</blockquote>
<p>返回相同类型或子类或其它类就可以链式调用，图灵等价，语言是基于需求的，没有高低之分，变量不变，意味着代码没顺序要求，线程安全，编译器更好优化，不使用变量，要么递归，要么顺推，折叠函数，要来一个比较函数，高阶函数利用，首先写一个Block，高阶函数帮我门生成一个新的函数。链式编程的思想，即将多个操作通过.连接起来，使得可读性更强，是将多个操作（多行代码）通过点号(.)链接在一起成为一句代码,使代码可读性好。a(1).b(2).c(3)。特点：方法的返回值是block,block必须有返回值（本身对象），block参数（需要操作的值）。代表：masonry框架。在swift中提供了包括map、filter、reduce等十分简洁优秀的高阶函数供我们对数组数据进行操作，同样情况下，遍历一个数组并求和在使用oc（不使用kvc）和swift的环境下的代码是这样的。无论是代码量还是简洁性，此时的oc都比不上swift。那么接下来就要通过神奇的block来为oc添加这些高阶函数的实现</p>
<blockquote>
<p>#函数式编程</p>
</blockquote>
<p>是把操作尽量写成一系列嵌套的函数或者方法调用。代表：ReactiveCocoa。特点：每个方法必须有返回值（本身对象）,把函数或者Block当做参数,block参数（需要操作的值）block返回值（操作结果）</p>
<blockquote>
<p>#函数响应式编程(Functional Reactive Programming:FRP)</p>
</blockquote>
<p>本质通过数据流表达应用功能。关注改变状态值的行为事件，这一系列事件组成了事件流。类似于OC的观察者设计模式。命令式编程语言中，a: = b + c 表示 a 是 b + c 表达式的值。但在RP语言中，表示动态数据流关系：只要c或b的值发生变化，a的值自动跟着变化。不需使用实例变量追踪瞬时状态，新输入值到达，函数立即根据最新输入值计算产生新输出值。</p>
<blockquote>
<p>#ReactiveCocoa优点</p>
</blockquote>
<p>函数响应式编程（FRP）框架。ReactiveCocoa为事件提供了很多处理方法，处理事件很方便，可以把要处理的事情，和监听的事情的代码放在一起，这样非常方便我们管理，就不需要跳到对应的方法里。非常符合我们开发中高聚合，低耦合的思想。使用RAC解决问题，不需考虑调用顺序，直接考虑结果，把原本分离的操作写成嵌套进一起，使代码高聚合，方便管理。</p>
<blockquote>
<p>#RACSignal</p>
</blockquote>
<p>简介：ReactiveCocoa signal（RACSignal）信号源发送信号给它的subscriber订阅者。主要发送三种信号：next值信号、error错误信号、completed结束信号。不同信号进入订阅者不同Block代码块。UIKit控件使用RAC框架的类别即可将空间的事件回调变成信号发送。原本是响应事件，现在是订阅信号。</p>
<ul>
<li><p>创建单元信号：RACSignal类方法创建单元信号对象。</p>
</li>
<li><p>创建动态信号：Block作为形参把信号订阅后需要执行的系列任务记录下来，传入RACSignal的类方法创建动态信号。形参Block的输入值就是订阅者RACSubscriber，意味着只要信号被订阅就可以执行Block里面的操作。</p>
</li>
<li><p>Cocoa桥接：RAC将Cocoa框架中的断点、事件、触发转变成信号，简直棒到没朋友！程序开始调用某方法时发送信号、控件接收到手势触发事件时发送信号、控件的特定属性发生改变时发送信号。所发送信号的值绑定到属性上。</p>
</li>
<li><p>信号变换：常见需求，当我订阅了信号并接收到信号的值，但是信号值与期望值还有点距离，那么必不可少的就是信号变换，本质上就是变换信号的值。</p>
</li>
<li><p>序列转换：sequence是个什么鬼，为啥sequence的signal属性就是序列装换？序列装换有啥用呀？</p>
</li>
<li><p>信号订阅：控件的手势触发、指定方法开始调用都会发出信号</p>
</li>
</ul>
<blockquote>
<p>RACDisposable</p>
</blockquote>
<p>类方法disposableWithBlock、销毁RACSignal信号对象、形参Block代码块封装信号的订阅者消失后所需要执行的代码（取消观察者Or取消代理）</p>
<blockquote>
<p>信号的订阅者消失</p>
</blockquote>
<p>订阅者发送error信号、订阅者发送Completed信号、订阅者的生命周期调用了dealloc</p>
<blockquote>
<p>SubscribeNext方法的内部实现逻辑</p>
</blockquote>
<p>创建订阅者subscriber(代号007)、订阅者保存Block形参、Block代码块就是从更大的一段代码块中抽离出来、订阅者要做的事情就是决定什么地方执行这个代码块</p>
<blockquote>
<p>RACCompoundDisposable</p>
</blockquote>
<p>RACDisposable的子类、方法addDisposable添加RACDisposable、block块执行清理操作</p>
<blockquote>
<p>单个信号变换</p>
</blockquote>
<p>值，数量，维度，时间间隔</p>
<blockquote>
<p>改变信号的值</p>
</blockquote>
<p>Map：遍历每个信号、block改变了next信号的值</p>
<p>Aggregate ：累加、全局变量存储累加值但不符合函数式编程、折叠函数不停向下传递累加值、伪递归不用存储栈里的中间变量</p>
<p>Scan：累加值没更新一次就发送一个新信号</p>
<p>MapReplace：next信号的值通通替换成固定值</p>
<p>ReduceEach：如果next信号的值是元祖、实现元祖的元素内部运算</p>
<blockquote>
<p>改变信号数量</p>
</blockquote>
<p>Take：只要几个信号。顾名思义就是拿的意思，拿什么，当然那信号源A里面的信号，拿几个，当然是自己定。不过注意的是，拿几个信号可不是随便拿，是严格按照信号产生的先后顺序来拿，当然不会拿已经产生很久的信号，肯定是拿最新的信号啦！</p>
<p>Skip：跳过第一个信号不要，顾名思义跳跃，跳跃什么，当然跳过信号啦，跳过最新出现的信号，至于跳过几个最新产生的信号，全屏自己来决定</p>
<p>startWith：增加一个信号。表示给信号源A添加一个自定义的信号，然后注意这个自定义的信号为开头，再组合信号A其它所有的信号，于是这样就组成了信号B。</p>
<p>repeat：循环出现已有的信号、无论什么信号。表示将信号源A里面的所有信号进行不断地重复，这样就是形成了一个新的信号源B，只是这个信号源A里面的信号总共会重复多少次呢，而且如果信号源A在无限循环重复的过程中，出现了新的信号怎么破？</p>
<p>retry：循环出现已有的信号、碰到错误信号重新循环。表示信号A有一个信号，然后来订阅信号源A里面的这个信号，重复订阅的意思，这就迷茫了，不是应该是操作信号源A里面的信号数量么，怎么搞成去订阅信号源A里面的信号了，简直不合常理。</p>
<p>throttle：阀门、重复点击不多次请求</p>
<p>Filter：可以设定条件过滤信号源A中不符合条件的信号，本质就是把信号源A的每个信号里的值都拿出来判断一下，如果这个信号的值满足所设定的判断，那么就把这个信号保留下来变成了信号源B所发的信号</p>
<p>Ignore：可以删除信号源A中指定值的信号。其实本质就是把信号源A发的每一个信号的值都拿出来判断一下，如果判断到从信号中取出的那个值就我所设定的值，那么把这个信号从信号源A中给删除掉，这样就生成了新的信号源B</p>
<p>takeLast：就是去拿信号源A中的最后几个信号</p>
<p>takeUntilBlock：一直去信号源A哪里拿信号直到下一个要拿的信号的值已经我们设定的判断条件</p>
<p>takeWhileBlock：判断信号源A中的每一个信号，哪一个信号的值满足我们设定的条件，我们就是从这个信号以下通通拿走组成一个新的信号源B</p>
<p>skipUntilBlock：本来信号源A一直跳跃，跳过万水千山，一直不肯安定下来，直到发现了真爱，这个真爱就是发现了下一个信号的值刚好满足自己设定的条件，那么自然就是停止跳跃，安定下来，就从这里开始提取信号源A的信号</p>
<p>skipWhileBlock：本来信号源A一直好好的，当判断下一个信号满足什么条件后就开始跳过这个信号，有点类似于判断每一个信号的值，如果下一个信号的值满足我们设定的条件，我们就把它过滤掉的意思，当然这里的官方语言是跳过，跳过和过滤还是有区别的，过滤可能只是过滤掉这一个，但是下一个还是会接着判断的，但是跳跃可就不是这样的了，跳跃意味着以后的信号都不会再处理，直接就结束信号的操作了，被跳跃的信号后面的所有信号都将不再存在。</p>
<p>any和All：属于混合操作，意思就是信号源A中信号每一个信号都需要来一次判断，只有满足多个复合条件的信号才留下，否则其它通通不留。这样也会生成新的信号源B</p>
<blockquote>
<p>多个信号的组合</p>
</blockquote>
<p>Contact：连接</p>
<p>Merge：组合，考虑分线程</p>
<p>Zip：拉链，信号源1和信号源2交替组成新的信号</p>
<p>CombineLatest：两个信号源的最后值结合组成新信号</p>
<p>Sample：采样，采集对方信号的最后一个值</p>
<p>TakeUntil：控制信号去停止另一个信号</p>
<blockquote>
<p>RACSubject</p>
</blockquote>
<p>冷信号？</p>
<p>本地下载点播，每次从头播放。不论订阅者时间先后订阅到的内容相同</p>
<p>热信号？</p>
<p>电视直播，可能中途开始，订阅者角度，主动启动，被动接收。订阅者订阅到的内容严格与时间相关</p>
<blockquote>
<p>RACSignal和RACSubject比较</p>
<p>RACScheduler</p>
</blockquote>
<p>异步库、实现异步、CPU来回调度兼顾多个任务、过度使用优先级万一整出两个第一名咋整、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div></pre></td><td class="code"><pre><div class="line">//创建单元信号（next值事件）</div><div class="line">RACSignal *signal1 = [RACSignal return:@&quot;Some Value&quot;];</div><div class="line">//创建单元信号（error错误事件）</div><div class="line">RACSignal *signal2 = [RACSignal error:errorObject];</div><div class="line">//创建单元信号（empty空事件）</div><div class="line">RACSignal *signal3 = [RACSignal empty];</div><div class="line">//创建单元信号（never永远事件）</div><div class="line">RACSignal *signal4 = [RACSignal never];</div><div class="line">//创建动态信号</div><div class="line">RACSignal *signal5 = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@1];</div><div class="line">    [subscriber sendNext:@2];</div><div class="line">    [subscriber sendError:errorObject];</div><div class="line">    [subscriber sendCompleted];</div><div class="line">    return [RACDisposable disposableWithBlock:^&#123;</div><div class="line"></div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">//创建方法监听信号</div><div class="line">RACSignal *signal6 = [view rac_signalForSelector:@selector(setFrame:)];</div><div class="line">//创建点击事件信号</div><div class="line">RACSignal *signal7 = [view rac_signalForControlEvents:UIControlEventTouchUpInside];</div><div class="line">//创建销毁事件信号</div><div class="line">RACSignal *signal8 = [view rac_willDeallocSignal];</div><div class="line">//创建控件属性信号</div><div class="line">RACSignal *signal9 = RACObserve(view, backgroundColor);</div><div class="line">//编辑旧信号返回新信号</div><div class="line">RACSignal *signal10 = [signal1 map:^id(NSString *value) &#123;</div><div class="line">   return [value substringFromIndex:1];</div><div class="line">&#125;];</div><div class="line">//序列转换</div><div class="line">RACSignal *signal11 = sequence.signal;</div><div class="line">//订阅一个信号</div><div class="line">[signal11 subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;next value is %@&quot;, x);</div><div class="line">&#125; error:^(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;Ops! Get some error: %@&quot;, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;It finished success&quot;);</div><div class="line">&#125;];</div><div class="line">//绑定</div><div class="line">RAC(view, backgroundColor) = signal10;</div><div class="line">[view rac_liftSelector:@selector(convertPoint:toView:) withSignals:signal1, signal2, nil];</div><div class="line">[view rac_liftSelector:@selector(convertRect:toView:)  withSignalsFromArray:@[signal3, signal4]];</div><div class="line">[view rac_liftSelector:@selector(convertRect:toLayer:) withSignalOfArguments:signal5];</div><div class="line">//订阅过程</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber)&#123;</div><div class="line">    [subscriber sendNext:@1];</div><div class="line">    [subscriber sendNext:@2];</div><div class="line">    [subscriber sendCompleted];</div><div class="line">    return [RACDisposable disposableWithBlock:^&#123;</div><div class="line">        NSLog(@&quot;dispose&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">//手动取消订阅，即使订阅者没有被销毁，仍然可以取消该信号</div><div class="line">RACDisposable *disposable = [signal subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;next value is %@&quot;, x);</div><div class="line">&#125; error:^(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;Ops! Get some error: %@&quot;, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;It finished success&quot;);</div><div class="line">&#125;];</div><div class="line">[disposable dispose];</div><div class="line">//元组RACTuple</div><div class="line">RACTuple * tuple = RACTuplePack(@1, @&quot;haha&quot;);</div><div class="line">id first  = tuple.first;</div><div class="line">id second = tuple.second;</div><div class="line">id last   = tuple.last;</div><div class="line">id index1 = tuple[1];</div><div class="line">RACTupleUnpack(NSNumber *num, NSString *str) = tuple;</div><div class="line">//值操作——Map</div><div class="line">RACSignal *signalB = [signalA map:^id(NSNumber *value) &#123;</div><div class="line">   return @(value.integerValue * 2);</div><div class="line">&#125;];</div><div class="line">//值操作——ReduceEach:</div><div class="line">RACSignal *signalB = [signalA reduceEach:^id(NSNumber *first,NSNumber *second) &#123;</div><div class="line">   return @(first.integerValue + second.integerValue);</div><div class="line">&#125;];</div><div class="line">//数量操作——Filter</div><div class="line">RACSignal *signalB = [signalA filter:^BOOL(NSString *value) &#123;</div><div class="line">   return value.length &gt; 2;</div><div class="line">&#125;];</div><div class="line">//数量操作——Ignore</div><div class="line">RACSignal *signalB = [signalA filter:^BOOL(id value) &#123;</div><div class="line">   return ![@1 isEqual:value];</div><div class="line">&#125;];</div><div class="line">RACSignal *signalC = [signalA ignore:@1];</div><div class="line">- (RACSignal *)ignoreValues;</div><div class="line">- (RACSignal *)distinctUntilChanged;</div><div class="line">//数量操作——Take</div><div class="line">RACSignal *signalB = [signalA take:2];</div><div class="line">//数量操作——Skip</div><div class="line">RACSignal *signalB = [signalA skip:1];</div><div class="line">//数量操作——Take&amp;Skip其他</div><div class="line">- (RACSignal *)takeLast:(NSUInteger)count;</div><div class="line">- (RACSignal *)takeUntilBlock:(BOOL (^)(id x))predicate;</div><div class="line">- (RACSignal *)takeWhileBlock:(BOOL (^)(id x))predicate;</div><div class="line">- (RACSignal *)skipUntilBlock:(BOOL (^)(id x))predicate;</div><div class="line">- (RACSignal *)skipWhileBlock:(BOOL (^)(id x))predicate;</div><div class="line">//数量混合操作</div><div class="line">- (RACSignal *)any;</div><div class="line">- (RACSignal *)any:(BOOL (^)(id object))predicateBlock;</div><div class="line">- (RACSignal *)all:(BOOL (^)(id object))predicateBlock;</div><div class="line">//数量操作——StartWith</div><div class="line">RACSignal *signalB = [signalA startWith:@&quot;Start&quot;];</div><div class="line">//数量操作——Repeat</div><div class="line">RACSignal *signalB = [signalA repeat];</div><div class="line">//数量操作——Retry,如果订阅都到了错误事件，重头开始订阅</div><div class="line">RACSignal *signalB = [signalA retry:2];</div><div class="line">//副作用操作--就是没有改变任何变量的值的操作</div><div class="line">RACSignal *signalB = [signalA map:^id(id value) &#123;</div><div class="line">   return value;</div><div class="line">&#125;];</div><div class="line">RACSignal *signalC = [signalA doNext:^(id x) &#123;</div><div class="line">   do some thing;</div><div class="line">&#125;];</div><div class="line">- (RACSignal *)doError:(void (^)(NSError *error))block;</div><div class="line">- (RACSignal *)doCompleted:(void (^)(void))block;</div><div class="line">- (RACSignal *)initially:(void (^)(void))block;</div><div class="line">- (RACSignal *)finally:(void (^)(void))block;</div><div class="line">//数量操作——Collect</div><div class="line">RACSignal *signalB = [signalA collect];</div><div class="line">//数量操作——Aggregate</div><div class="line">typedef int(^FoldFunction)(int running, int next);</div><div class="line">int fold(int *array, int count, FoldFunction func, int start)&#123;</div><div class="line">    int current = array[0];</div><div class="line">    int running = func(start, current);</div><div class="line">    if (count == 1) return running;;</div><div class="line">    return fold(array + 1, count - 1, func, running);</div><div class="line">&#125;</div><div class="line">    int arr[] = &#123;1, 2, 3, 4, 5&#125;;</div><div class="line">    int result = fold(arr, 5, ^int(int running, int next) &#123;</div><div class="line">    return running + next;</div><div class="line">&#125;, 0);</div><div class="line">//数量操作——Aggregate</div><div class="line">RACSignal *signalB = [signalA aggregateWithStart:@0 reduce:^id(NSNumber *running,NSNumber *next) &#123;</div><div class="line">     return @(running.integerValue + next.integerValue);</div><div class="line">&#125;];</div><div class="line">//值操作——Scan</div><div class="line">RACSignal *signalB = [signalA scanWithStart:@0 reduce:^id(NSNumber *running,NSNumber *next) &#123;</div><div class="line">    return @(running.integerValue + next.integerValue);</div><div class="line">&#125;];</div><div class="line">//Aggregate&amp;Scan变种</div><div class="line">- (RACSignal *)aggregateWithStart:(id)start reduceWithIndex:(id (^)(id running,id next,NSUInteger index))reduceBlock;</div><div class="line">- (RACSignal *)aggregateWithStartFactory:(id (^)(void))startFactory reduce:(id (^)(id running,id next))reduceBlock;</div><div class="line">- (RACSignal *)scanWithStart:(id)startingValue reduceWithIndex:(id (^)(id running,id next,NSUInteger index))reduceBlock;</div><div class="line">//无限递增信号、斐波那契数列信号</div><div class="line">RACSignal *repeat1 = [[RACSignal return:@1] repeat];</div><div class="line">RACSignal *signalB = [repeat1 scanWithStart:@0 reduce:^id(NSNumber *running,NSNumber *next) &#123;</div><div class="line">    return @(running.integerValue + next.integerValue);</div><div class="line">&#125;];</div><div class="line">RACSignal *signalC = [repeat1 scanWithStart:RACTuplePack(@1, @1) reduce:^id(RACTuple *running, id _) &#123;</div><div class="line">    NSNumber *next = @([running.first integerValue] + [running.second integerValue]);</div><div class="line">    return RACTuplePack(running.second, next);</div><div class="line">&#125;];</div><div class="line">//时间操作——有用的信号</div><div class="line">+ (RACSignal *)interval:(NSTimeInterval)interval onScheduler:(RACScheduler *)scheduler;</div><div class="line">+ (RACSignal *)interval:(NSTimeInterval)interval onScheduler:(RACScheduler *)scheduler  withLeeway:(NSTimeInterval)leeway;</div><div class="line">//时间操作——Delay</div><div class="line">RACSignal *signalB = [signalA delay:1];</div><div class="line">RACSignal *interval = [[[RACSignal return:@1] delay:1] repeat];</div><div class="line">//时间操作——Throttle</div><div class="line">RACSignal *signalB = [signalA throttle:2];</div><div class="line">//时间操作——类似Throttle的方法</div><div class="line">- (RACSignal *)throttle:(NSTimeInterval)interval valuesPassingTest:(BOOL (^)(id next))predicate;</div><div class="line">- (RACSignal *)bufferWithTime:(NSTimeInterval)interval onScheduler:(RACScheduler *)scheduler;</div><div class="line">//组合操作——Concat皇帝和太子，谁发号施令</div><div class="line">RACSignal *signalC = [signalA concat:signalB];</div><div class="line">//组合操作——Merge</div><div class="line">RACSignal *signalC = [signalA merge:signalB];</div><div class="line">RACSignal *signalC = [RACSignal merge:@[signalA, signalB]];</div><div class="line">RACSignal *signalC = [RACSignal merge:RACTuplePack(signalA, signalB)];</div><div class="line">//Merge综合应用</div><div class="line">RACSignal *appearSignal = [[self rac_signalForSelector:@selector(viewDidAppear:)]</div><div class="line">mapReplace:@YES];</div><div class="line">RACSignal *disappearSignal = [[self rac_signalForSelector:@selector(viewWillDisappear:)]</div><div class="line">mapReplace:@NO];</div><div class="line">RACSignal *activeSignal = [RACSignal merge:@[appearSignal, disappearSignal]];</div><div class="line">//组合操作——Zip夫妻决定一件事情必须双方都同意,各拿一个值事件组成元祖，不能重复拿值事件</div><div class="line">RACSignal *signalC = [signalA zipWith:signalB];</div><div class="line">RACSignal *signalC = [RACSignal zip:@[signalA, signalB]];</div><div class="line">RACSignal *signalC = [RACSignal zip:RACTuplePack(signalA, signalB)];</div><div class="line">//组合操作——CombineLatest各拿一个最新值事件组成一个元祖</div><div class="line">RACSignal *signalC = [signalA combineLatestWith:signalB];</div><div class="line">RACSignal *signalC = [RACSignal combineLatest:@[signalA, signalB]];</div><div class="line">组合操作——Zip&amp;CombineLatest更多操作</div><div class="line">+ (RACSignal *)combineLatest:(id&lt;NSFastEnumeration&gt;)signals reduce:(id (^)())reduceBlock;</div><div class="line">+ (RACSignal *)zip:(id&lt;NSFastEnumeration&gt;)streams reduce:(id (^)())reduceBlock;</div><div class="line">//组合操作——Sample用B接收A最近的值事件</div><div class="line">RACSignal *signalC = [signalA sample:signalB];</div><div class="line">//组合操作——TakeUntil</div><div class="line">RACSignal *signalC = [signalA takeUntil:signalB];</div><div class="line">//组合操作——TakeUntilReplacement</div><div class="line">RACSignal *signalC = [signalA takeUntilReplacement:signalB];</div><div class="line">ReactiveCocoa之冷信号与热信号</div><div class="line">//冷热信号转换本质</div><div class="line">    return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        RACStreamBindBlock bindBlock = block();</div><div class="line">        [self subscribeNext:^(id x) &#123;</div><div class="line">        BOOL stop = NO;</div><div class="line">        RACSignal *signal = (RACSignal *)bindBlock(x, &amp;stop);</div><div class="line">        if (signal == nil || stop) &#123; [subscriber sendCompleted];</div><div class="line">        &#125; else &#123;</div><div class="line">        [signal subscribeNext:^(id x) &#123; [subscriber sendNext:x];</div><div class="line">        &#125; error:^(NSError *error) &#123; [subscriber sendError:error];</div><div class="line">        &#125; completed:^&#123; &#125;];</div><div class="line">        &#125;</div><div class="line">        &#125; error:^(NSError *error) &#123; [subscriber sendError:error];</div><div class="line">        &#125; completed:^&#123; [subscriber sendCompleted]; &#125;];</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line">//热信号RACSubject</div><div class="line">RACSubject *subject = [RACSubject subject];</div><div class="line">[subject subscribeNext:^(id x) &#123;&#125; error:^(NSError *error) &#123;&#125; completed:^&#123;&#125;];</div><div class="line">[subject sendNext:@1];</div><div class="line">[subject sendNext:@2];</div><div class="line">[subject sendNext:@3];</div><div class="line">[subject sendCompleted];</div><div class="line">//RACReplaySubject带快速回播的Subject</div><div class="line">RACReplaySubject *subject = [RACReplaySubject replaySubjectWithCapacity:1];</div><div class="line">[subject sendNext:@1];</div><div class="line">[subject sendNext:@2];</div><div class="line">[subject sendCompleted];</div><div class="line">[subject subscribeNext:^(id x) &#123;  /* a*/  &#125;];</div><div class="line">//冷信号 -&gt; 热信号:RACSubject有权对从RACSignal哪里订阅到的值事件做分发和处理</div><div class="line">RACSignal *signal = @[@1, @2, @3, @4].rac_sequence.signal;</div><div class="line">RACSignal *signalB = [[signal map:^id(id value) &#123;</div><div class="line">return [[RACSignal return:value] delay:1];</div><div class="line">&#125;] concat];</div><div class="line">RACSubject *speaker = [RACSubject subject];</div><div class="line">[signalB subscribe:speaker];</div><div class="line">[speaker subscribeNext:^(id x) &#123;  // a &#125;];</div><div class="line">[speaker subscribeNext:^(id x) &#123;  // b &#125;];</div><div class="line">[speaker subscribeNext:^(id x) &#123;  // c &#125;];</div><div class="line">//冷信号 -&gt; 热信号 官方方案</div><div class="line">- (RACMulticastConnection *)publish;</div><div class="line">- (RACMulticastConnection *)multicast:(RACSubject *)subject;</div><div class="line">- (RACSignal *)replay;</div><div class="line">- (RACSignal *)replayLast;</div><div class="line">- (RACSignal *)replayLazily;</div><div class="line">//冷信号+副作用方法</div><div class="line">+ (RACSignal *)defer:(RACSignal * (^)(void))block;</div><div class="line">- (RACSignal *)then:(RACSignal * (^)(void))block;</div><div class="line">//不建议使用的同步方法</div><div class="line">- (id)first;</div><div class="line">- (id)firstOrDefault:(id)defaultValue;</div><div class="line">- (id)firstOrDefault:(id)defaultValue success:(BOOL *)success error:(NSError **)error;</div><div class="line">- (BOOL)waitUntilCompleted:(NSError **)error;</div><div class="line">- (NSArray *)toArray;</div><div class="line">@property (nonatomic, strong, readonly) RACSequence *sequence;</div><div class="line">//groupBy很多个普通值事件的信号变成包含两个信号值事件的高阶信号</div><div class="line">- (RACSignal *)groupBy:(id&lt;NSCopying&gt; (^)(id object))keyBlock;</div><div class="line">- (RACSignal *)groupBy:(id&lt;NSCopying&gt; (^)(id object))keyBlock transform:(id (^)(id object))transformBlock;</div><div class="line">RACSignal *signal = @[@1, @2, @3, @4].rac_sequence.signal;</div><div class="line">RACSignal *signalGroup = [signal groupBy:^NSString *(NSNumber *object) &#123;</div><div class="line">    return object.integerValue % 2 == 0 ? @&quot;odd&quot; : @&quot;even&quot;;</div><div class="line">&#125;];</div><div class="line">[[[signalGroup take:1] flatten] subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;next: %@&quot;, x);</div><div class="line">&#125;];</div><div class="line">同步:方法或函数不返回结果不进行下一步,事无巨细，亲力亲为</div><div class="line">异步:分身有术</div><div class="line">并发:统筹兼顾</div><div class="line">并行:专人专事</div><div class="line">// 主线程的Scheduler</div><div class="line">RACScheduler *mainScheduler = [RACScheduler mainThreadScheduler];</div><div class="line">// 子线程的Scheduler</div><div class="line">RACScheduler *scheduler2 = [RACScheduler scheduler];</div><div class="line">// 返回当前的Scheduler</div><div class="line">RACScheduler *scheduler3 = [RACScheduler currentScheduler];</div><div class="line">// 设置Scheduler的优先级,注意两个都是老子天下第一</div><div class="line">RACScheduler *scheduler4 = [RACScheduler schedulerWithPriority:RACSchedulerPriorityHigh];</div><div class="line">RACScheduler *scheduler5 = [RACScheduler schedulerWithPriority:RACSchedulerPriorityHigh name:@&quot;someName&quot;];</div><div class="line">// 创建立即的Scheduler</div><div class="line">RACScheduler  *scheduler6 = [RACScheduler immediateScheduler];</div><div class="line">// 调度程序在mainScheduler里面执行任务，同时可以随时取消任务的执行</div><div class="line">RACDisposable *disposable = [mainScheduler schedule:^&#123; /* </div><div class="line">// 时间之后调度程序在scheduler1里面执行</div><div class="line">NSDateFormatter *formatter = [[NSDateFormatter alloc] init];</div><div class="line">formatter.dateFormat = @&quot;yyyy-MM-dd HH:mm:ss&quot;;</div><div class="line">NSDate *date = [formatter dateFromString:@&quot;2016-07-20 21:00:00&quot;];</div><div class="line">[scheduler1 after:date schedule:^&#123; /* </div><div class="line">// 秒之后调度程序在scheduler2里面执行</div><div class="line">[scheduler2 afterDelay:30 schedule:^&#123; /* </div><div class="line">// 时间之后调度程序在scheduler3里面执行,没隔1秒执行一次，算上允许延迟的0.1秒，执行时间最长1.1秒</div><div class="line">[scheduler3 after:[NSDate date] repeatingEvery:1 withLeeway:0.1 schedule:^&#123;&#125;];</div><div class="line"></div><div class="line"></div><div class="line">RACScheduler vs GCD</div><div class="line">//异步订阅:创建子线程Scheduler执行subscribeNext方法</div><div class="line">[[RACScheduler scheduler] schedule:^&#123;</div><div class="line">    [signal subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;333&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">//异步发送:创建子线程Scheduler执行sendNext方法</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    RACDisposable *disposable = [[RACScheduler scheduler] schedule:^&#123;</div><div class="line">        [subscriber sendNext:@1];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return disposable;</div><div class="line">&#125;];</div><div class="line">//同步发送在前异步发送在后:subscribeNext的Block代码块先在主线程执行，后在子线程执行</div><div class="line">//一会儿主线程激活subscribeNext一会儿子线程激活subscribeNext，自己的路自己走到底</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@0.1];</div><div class="line">    RACDisposable *disposable = [[RACScheduler scheduler] schedule:^&#123;</div><div class="line">        [subscriber sendNext:@1.1];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return disposable;</div><div class="line">&#125;];</div><div class="line">//订阅和发送都异步:异步高于同步，发送优于订阅</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@0.1];</div><div class="line">    RACDisposable *disposable = [[RACScheduler scheduler] schedule:^&#123;</div><div class="line">        [subscriber sendNext:@1.1];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return disposable;</div><div class="line">&#125;];</div><div class="line">[[RACScheduler scheduler] schedule:^&#123;</div><div class="line">    [signal subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;, x);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">//subscribeOn:保证didSubscribe的Block在指定schedule执行,比如说在didSubscribe的Block里执行添加UIKit控件到父视图的代码</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@0.1];</div><div class="line">    RACDisposable *disposable = [[RACScheduler scheduler] schedule:^&#123;</div><div class="line">        [subscriber sendNext:@1.1];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return disposable;</div><div class="line">&#125;];</div><div class="line">[[RACScheduler scheduler] schedule:^&#123;</div><div class="line">    [[signal subscribeOn:[RACScheduler mainThreadScheduler]] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;, x);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">//deliverOn:保证subscribeNext的Block在指定schedule执行</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@0.1];</div><div class="line">    RACDisposable *disposable = [[RACScheduler scheduler] schedule:^&#123;</div><div class="line">        [subscriber sendNext:@1.1];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return disposable;</div><div class="line">&#125;];</div><div class="line">[[RACScheduler scheduler] schedule:^&#123;</div><div class="line">    [[signal deliverOn:[RACScheduler mainThreadScheduler]] subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;, x);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">//subscribeOn:的用武之地</div><div class="line">void whenShouldWeUseSubscribeOn()</div><div class="line">&#123;</div><div class="line">UIView *view = [[UIView alloc] init];</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">UILabel *label = [[UILabel alloc] init];</div><div class="line">label.text = @&quot;Hello world&quot;;</div><div class="line">[view addSubview:label];</div><div class="line">[subscriber sendNext:@0.1];</div><div class="line">RACDisposable *disposable = [[RACScheduler scheduler] schedule:^&#123;</div><div class="line">[subscriber sendNext:@1.1];</div><div class="line">[subscriber sendCompleted];</div><div class="line">&#125;];</div><div class="line">return disposable;</div><div class="line">&#125;];</div><div class="line">[[RACScheduler scheduler] schedule:^&#123;</div><div class="line">[[signal subscribeOn:[RACScheduler mainThreadScheduler]] subscribeNext:^(id x) &#123;</div><div class="line">NSLog(@&quot;%@&quot;, x);</div><div class="line">&#125;];</div><div class="line">&#125;]; &#125;</div><div class="line"></div><div class="line">ReactiveCocoa之信号高阶操作</div><div class="line"></div><div class="line">//创造高阶信号</div><div class="line">RACSignal *signal = [RACSignal return:@1];</div><div class="line">RACSignal *signalHighOrder = [RACSignal return:signal];</div><div class="line">RACSignal *anotherSignal = [signal map:^id(id value) &#123;</div><div class="line">    return [RACSignal return:value];</div><div class="line">&#125;];</div><div class="line">//订阅高阶信号</div><div class="line">RACSignal *signal = @[@1, @2, @3].rac_sequence.signal;</div><div class="line">RACSignal *highOrderSignal = [signal map:^id(id value) &#123;</div><div class="line">    return [RACSignal return:value];</div><div class="line">&#125;];</div><div class="line">[highOrderSignal subscribeNext:^(RACSignal *aSignal) &#123;</div><div class="line">    [aSignal subscribeNext:^(id x) &#123;</div><div class="line">        // get real value here.</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">//降阶操作——SwitchToLatests一旦订阅到新信号的值立马销毁旧信号</div><div class="line">RACSignal *signalB = [signalA switchToLatest]; </div><div class="line">RACSignal *autoRunButtonClickSignal = [self.autoRunBtn rac_signalForControlEvents:UIControlEventTouchUpInside];</div><div class="line">RACSignal *oneStepButtonClickSignal = [self.oneStepBtn rac_signalForControlEvents:UIControlEventTouchUpInside];</div><div class="line">RACSignal *idSignal = [RACSignal return:nil];</div><div class="line">RACSignal *timerSignal = [RACSignal interval:1 onScheduler:[RACScheduler mainThreadScheduler]];</div><div class="line">autoRunButtonClickSignal = [autoRunButtonClickSignal mapReplace:idSignal];</div><div class="line">oneStepButtonClickSignal = [oneStepButtonClickSignal mapReplace:timerSignal];</div><div class="line">RACSignal *controlSignal = [autoRunButtonClickSignal merge:oneStepButtonClickSignal];</div><div class="line">controlSignal = [controlSignal switchToLatest];</div><div class="line">//填词搜索示例，信号事件降阶成值事件，同时一旦处理新的信号事件的值事件，立即结束前一个信号事件</div><div class="line">RACSignal *searchTextSignal = [self.searchTextField rac_textSignal];</div><div class="line">RACSignal *requestSignals = [searchTextSignal map:^id(NSString *searchText) &#123;</div><div class="line">    NSString *urlString = [NSString stringWithFormat:</div><div class="line">    @&quot;http://xxxx.xxx.xxx/?q=%@&quot;, searchText];</div><div class="line">    NSURL *url = [NSURL URLWithString:urlString];</div><div class="line">    NSURLRequest *request = [NSURLRequest requestWithURL:url];</div><div class="line">    return [NSURLConnection rac_sendAsynchronousRequest:request];</div><div class="line">&#125;];</div><div class="line">requestSignals = [requestSignals switchToLatest];</div><div class="line">//降阶操作——If/then/else如果是YES订阅信号A如果是NO订阅信号B的原理就是switchToLatest来实现</div><div class="line">RACSignal *signalB = [RACSignal if: signalA then: signalTrue else: signalFalse]; </div><div class="line">+ (RACSignal *)if:(RACSignal *)boolSignal then:(RACSignal *)trueSignal else:(RACSignal *)falseSignal &#123;</div><div class="line">    return [[boolSignal map:^(NSNumber *value) &#123;</div><div class="line">        return (value.boolValue ? trueSignal : falseSignal);</div><div class="line">    &#125;] switchToLatest];</div><div class="line">&#125;</div><div class="line">+ (RACSignal *)switch:(RACSignal *)signal cases:(NSDictionary *)cases default:(RACSignal *)defaultSignal;</div><div class="line">降阶操作——Flatten按照时间顺序订阅每一个信号的每一个值事件</div><div class="line">RACSignal *signalB = [signalA flatten]; </div><div class="line">RACSignal *signalB = [signalA flatten:2];</div><div class="line">RACSignal *signalB = [signalA flatten:1];</div><div class="line">//高阶信号concat连续方法</div><div class="line">RACSignal *signal = @[@1, @3, @7, @9, @8].rac_sequence.signal;</div><div class="line">RACSignal *timerSignal = [[signal map:^id(id value) &#123;</div><div class="line">    return [[RACSignal return:value] delay:1];</div><div class="line">&#125;] concat];</div><div class="line">//降阶操作总结</div><div class="line">SwitchToLatests</div><div class="line">Flatten(</div><div class="line"></div><div class="line">思考1:改变某个值的个数</div><div class="line">RACSignal *signal = @[@1, @2, @3].rac_sequence.signal;</div><div class="line">RACSignal *mappedSignal = [[signal map:^id(NSNumber *value) &#123;</div><div class="line">    return [[[RACSignal return:value] repeat] take:value.integerValue];</div><div class="line">&#125;] flatten];</div><div class="line">思考2:将一个值改为错误</div><div class="line">RACSignal *signal = @[@1, @2, @3, @0].rac_sequence.signal;</div><div class="line">RACSignal *mappedSignal = [[signal map:^id(NSNumber *value) &#123;</div><div class="line">    if (value.integerValue == 0) &#123;</div><div class="line">        return [RACSignal error:[NSError errorWithDomain:@&quot;0&quot; code:0 userInfo:nil]];</div><div class="line">    &#125;else &#123;</div><div class="line">        return [RACSignal return:value];</div><div class="line">    &#125;</div><div class="line">&#125;] flatten];</div><div class="line">思考3:改变值的时间间隔</div><div class="line">RACSignal *signal = @[@&quot;♪5&quot;, @&quot;♬1&quot;, @&quot;♬2&quot;, @&quot;♬3&quot;, @&quot;♩4&quot;].rac_sequence.signal;</div><div class="line">NSDictionary *toneLengthMap = @&#123;@&quot;♩&quot;: @0.5, @&quot;♪&quot;: @0.25, @&quot;♬&quot;: @0.125&#125;;</div><div class="line">RACSignal *mappedSignal = [[signal map:^id(NSString *value) &#123;</div><div class="line">    NSString *tone = [value substringFromIndex:1];</div><div class="line">    NSString *length = [value substringToIndex:1];</div><div class="line">    NSNumber *toneValue = @(tone.integerValue);</div><div class="line">    NSNumber *toneLength = toneLengthMap[length];</div><div class="line">    return [[RACSignal return:toneValue] concat:[[RACSignal empty] delay: toneLength.doubleValue]];</div><div class="line">&#125;] concat];</div><div class="line">修改每一个普通值事件成为信号值事件，然后执行信号值事件的信号的flatten降阶操作</div><div class="line">RACSignal *flatten = [signal flattenMap:^RACStream *(RACSignal *value) &#123;</div><div class="line">    return value;</div><div class="line">&#125;];</div><div class="line">RACSignal *map = [signal flattenMap:^RACStream *(id value) &#123;</div><div class="line">    id anotherValue = value; // map here!</div><div class="line">    return [RACSignal return: anotherValue];</div><div class="line">&#125;];</div><div class="line">RACSignal *filter = [signal flattenMap:^RACStream *(id value) &#123;</div><div class="line">    BOOL filter = (value == nil); // filter here!</div><div class="line">    return filter ? [RACSignal empty] : [RACSignal return:value];</div><div class="line">&#125;];</div><div class="line">//FlattenMap网络请求数据的逻辑Demo</div><div class="line">RACSignal *signal = [RACSignal return:@&quot;http://xx.com/a&quot;];</div><div class="line">RACSignal *getSignal = [signal flattenMap: ^RACStream *(NSString *url) &#123;</div><div class="line">    NSURLRequest *request = [NSURLRequest requestWithURL:[NSURL URLWithString:url]];</div><div class="line">    return [NSURLConnection rac_sendAsynchronousRequest:request];</div><div class="line">&#125;];</div><div class="line">RACSignal *jsonSignal = [getSignal flattenMap: ^RACStream *(NSData *data) &#123;</div><div class="line">    NSError *error = nil;</div><div class="line">    id result = [NSJSONSerialization JSONObjectWithData:data options:0 error:&amp;error];</div><div class="line">    return error == nil ? [RACSignal return: result] : [RACSignal error: error];</div><div class="line">&#125;];</div><div class="line">RACSignal *getItemSignal = [jsonSignal flattenMap: ^RACStream *(NSDictionary *value) &#123;</div><div class="line">    if (![value isKindOfClass:[NSDictionary class]] || value[@&quot;data.url&quot;] == nil) &#123;</div><div class="line">        return [RACSignal error:someError];</div><div class="line">    &#125;</div><div class="line">    NSURLRequest *anotherRequest = [NSURLRequest requestWithURL:[NSURL URLWithString:value[@&quot;data.url&quot;]]];</div><div class="line">    return [NSURLConnection rac_sendAsynchronousRequest:anotherRequest];</div><div class="line">&#125;];</div><div class="line"></div><div class="line"></div><div class="line">FlattenMap与monad、bind</div><div class="line">Functor</div><div class="line"></div><div class="line">- (instancetype)flattenMap:(RACStream * (^)(id value))block;</div><div class="line">- (instancetype)bind:(RACStreamBindBlock (^)(void))block;</div><div class="line">typedef RACStream * (^RACStreamBindBlock)(id value, BOOL *stop);</div><div class="line">• •</div><div class="line">• •</div><div class="line"></div><div class="line">//bind妙用</div><div class="line">- (RACSignal *)take:(NSUInteger)count &#123;</div><div class="line">    if (count == 0) return [RACSignal empty];</div><div class="line">    return [self bind:^&#123;</div><div class="line">        __block NSUInteger taken = 0;</div><div class="line">        return ^ id (id value, BOOL *stop) &#123;</div><div class="line">            if (taken &lt; count) &#123;</div><div class="line">                ++taken;</div><div class="line">                if (taken == count) *stop = YES;</div><div class="line">                return [class return:value];</div><div class="line">            &#125; else &#123;</div><div class="line">                return nil;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//bind简单实现和问题</div><div class="line">- (RACSignal *)bind:(RACStreamBindBlock (^)(void))block;</div><div class="line">&#123;</div><div class="line">    return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    RACStreamBindBlock bindBlock = block();</div><div class="line">    [self subscribeNext:^(id x) &#123;</div><div class="line">    BOOL stop = NO;</div><div class="line">    RACSignal *signal = (RACSignal *)bindBlock(x, &amp;stop);</div><div class="line">    if (signal == nil || stop) &#123; [subscriber sendCompleted];</div><div class="line">    &#125; else &#123;</div><div class="line">    [signal subscribeNext:^(id x) &#123; [subscriber sendNext:x];</div><div class="line">    &#125; error:^(NSError *error) &#123; [subscriber sendError:error];</div><div class="line">    &#125; completed:^&#123; &#125;];</div><div class="line">    &#125;</div><div class="line">    &#125; error:^(NSError *error) &#123; [subscriber sendError:error];</div><div class="line">    &#125; completed:^&#123; [subscriber sendCompleted]; &#125;];</div><div class="line">    return nil;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line">//有用的高阶操作</div><div class="line">- (RACSignal *)try:(BOOL (^)(id value, NSError **errorPtr))tryBlock;</div><div class="line">- (RACSignal *)tryMap:(id (^)(id value, NSError **errorPtr))mapBlock;</div><div class="line">- (RACSignal *)catch:(RACSignal * (^)(NSError *error))catchBlock;</div><div class="line">- (RACSignal *)catchTo:(RACSignal *)signal;</div><div class="line">- (RACSignal *)timeout:(NSTimeInterval)interval onScheduler:(RACScheduler *)scheduler;</div><div class="line"></div><div class="line"></div><div class="line">ReactiveCocoa之生命周期详解</div><div class="line">//RACSignal:冷信号的实例状态</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">   [subscriber sendNext:@1];</div><div class="line">   [subscriber sendNext:@2];</div><div class="line">   [subscriber sendCompleted];</div><div class="line">   return nil;</div><div class="line">&#125;];</div><div class="line">[signal subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;next: %@&quot;, x);</div><div class="line">&#125; error:^(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;error: %@&quot;, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;complete&quot;);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//RACSubject:热信号的实例状态</div><div class="line">RACSubject *subject = [RACSubject subject];</div><div class="line">[subject subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive next: %@&quot;, x);</div><div class="line">&#125; error:^(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive error: %@&quot;, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive complete&quot;);</div><div class="line">&#125;];</div><div class="line">[subject sendNext:@1];</div><div class="line">[subject sendNext:@2];</div><div class="line">[subject sendCompleted];</div><div class="line"></div><div class="line">延时操作和Block生命周期</div><div class="line">NSString *someStr = @&quot;someStr&quot;; </div><div class="line">[[RACScheduler scheduler] afterDelay:1 schedule:^&#123;</div><div class="line">    NSLog(@&quot;%@&quot;, someStr);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//mainThreadScheduler:延时操作和Block生命周期</div><div class="line">NSString *someStr = @&quot;someStr&quot;;</div><div class="line">[[RACScheduler mainThreadScheduler] afterDelay:1 schedule:^&#123;</div><div class="line">    NSLog(@&quot;%@&quot;, someStr);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">延时操作和Block生命周期</div><div class="line">NSString *someStr = @&quot;someStr&quot;;</div><div class="line">NSString *someOtherStr = @&quot;someOtherStr&quot;;</div><div class="line">[RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">    NSLog(@&quot;%@&quot;, someStr);</div><div class="line">    NSString *innerStr = @&quot;innerStr&quot;;</div><div class="line">    [RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">        NSLog(@&quot;%@ &amp;&amp; %@&quot;, someOtherStr, innerStr);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//afterDelay:延时订阅冷信号的情况</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@1];</div><div class="line">    [subscriber sendNext:@2];</div><div class="line">    [subscriber sendCompleted];</div><div class="line">    return nil;</div><div class="line">&#125;];</div><div class="line">[signal subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive next: %@&quot;, x);</div><div class="line">&#125; error:^(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive error: %@&quot;, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive complete&quot;);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">[RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">    [signal subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;Subscriber 2 receive next: %@&quot;, x);</div><div class="line">    &#125; error:^(NSError *error) &#123;</div><div class="line">        NSLog(@&quot;Subscriber 2 receive error: %@&quot;, error);</div><div class="line">    &#125; completed:^&#123;</div><div class="line">        NSLog(@&quot;Subscriber 2 receive complete&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//afterDelay:延时订阅热信号的情况</div><div class="line">RACSubject *subject = [RACReplaySubject subject];</div><div class="line">[subject subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive next: %@&quot;, x);</div><div class="line">&#125; error:^(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive error: %@&quot;, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive complete&quot;);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">[RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">    [subject subscribeNext:^(id x) &#123;</div><div class="line">        NSLog(@&quot;Subscriber 2 receive next: %@&quot;, x);</div><div class="line">    &#125; error:^(NSError *error) &#123;</div><div class="line">        NSLog(@&quot;Subscriber 2 receive error: %@&quot;, error);</div><div class="line">    &#125; completed:^&#123;</div><div class="line">        NSLog(@&quot;Subscriber 2 receive complete&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">[subject sendNext:@1];</div><div class="line">[subject sendNext:@2];</div><div class="line">[subject sendCompleted];</div><div class="line"></div><div class="line"></div><div class="line">//afterDelay:冷信号延时发送</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">        [subscriber sendNext:@1];</div><div class="line">        [subscriber sendNext:@2];</div><div class="line">    &#125;];</div><div class="line">    [RACScheduler.mainThreadScheduler afterDelay:2 schedule:^&#123;</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return nil;</div><div class="line">&#125;]; </div><div class="line">[signal subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive next: %@&quot;, x);</div><div class="line">&#125; error:^(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive error: %@&quot;, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive complete&quot;);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//afterDelay:热信号延时发送</div><div class="line">RACSubject *subject = [RACSubject subject];</div><div class="line">[subject subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive next: %@&quot;, x);</div><div class="line">&#125; error:^(NSError *error) &#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive error: %@&quot;, error);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;Subscriber 1 receive complete&quot;);</div><div class="line">&#125;];</div><div class="line">[RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">    [subject sendNext:@1];</div><div class="line">    [subject sendNext:@2];</div><div class="line">    [subject sendCompleted];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//信号变换的生命周期</div><div class="line">- (RACSignal *)myMap_:(id (^)(id))map</div><div class="line">&#123;</div><div class="line">    NSCParameterAssert(map != nil);</div><div class="line">    return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [self subscribeNext:^(id x) &#123;</div><div class="line">            [subscriber sendNext:map(x)];</div><div class="line">        &#125; error:^(NSError *error) &#123;</div><div class="line">            [subscriber sendError:error];</div><div class="line">        &#125; completed:^&#123;</div><div class="line">            [subscriber sendCompleted];</div><div class="line">        &#125;];</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (RACSignal *)myMap2_:(id (^)(id))map</div><div class="line">&#123;</div><div class="line">    @weakify(self)</div><div class="line">    NSCParameterAssert(map != nil);</div><div class="line">    return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        @strongify(self)</div><div class="line">        [self subscribeNext:^(id x) &#123;</div><div class="line">            [subscriber sendNext:map(x)];</div><div class="line">        &#125; error:^(NSError *error) &#123;</div><div class="line">            [subscriber sendError:error];</div><div class="line">        &#125; completed:^&#123;</div><div class="line">            [subscriber sendCompleted];</div><div class="line">        &#125;];</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (RACSignal *)myMap_:(id (^)(id))map</div><div class="line">&#123;</div><div class="line">    [self subscribeNext:^(id x) &#123; </div><div class="line">    NSCParameterAssert(map != nil);</div><div class="line">    return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        [subscriber sendNext:map(x)];</div><div class="line">    &#125; error:^(NSError *error) &#123;</div><div class="line">        [subscriber sendError:error];</div><div class="line">    &#125; completed:^&#123;</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">        return nil;</div><div class="line">  &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">void signalTransform()</div><div class="line">&#123;</div><div class="line">    RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; s) &#123;</div><div class="line">        [s sendNext:@1];</div><div class="line">        [RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">            [s sendCompleted];</div><div class="line">        &#125;];</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">    RACSignal *signal2 = [signal myMap_:^id(NSNumber *value) &#123;</div><div class="line">        return @(value.integerValue * 2);</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    [RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">        [signal2 subscribeNext:^(id x) &#123;</div><div class="line">            NSLog(@&quot;Subscriber 1 receive next: %@&quot;, x);</div><div class="line">        &#125; error:^(NSError *error) &#123;</div><div class="line">            NSLog(@&quot;Subscriber 1 receive error: %@&quot;, error);</div><div class="line">        &#125; completed:^&#123;</div><div class="line">            NSLog(@&quot;Subscriber 1 receive complete&quot;);</div><div class="line">        &#125;];</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//信号组合时的生命周期</div><div class="line">+ (RACSignal *)myMerge_:(id&lt;NSFastEnumeration&gt;)signals</div><div class="line">&#123;</div><div class="line">    return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        for (RACSignal *signal in signals) &#123;</div><div class="line">            [signal subscribeNext:^(id x) &#123;</div><div class="line">                [subscriber sendNext:x];</div><div class="line">            &#125; error:^(NSError *error) &#123;</div><div class="line">                [subscriber sendError:error];</div><div class="line">            &#125; completed:^&#123;</div><div class="line">                [subscriber sendCompleted];</div><div class="line">            &#125;];</div><div class="line">        &#125;</div><div class="line">        return nil;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//RACDisposable对象断开订阅连接和RACScheduler对象（销毁信号）</div><div class="line">@interface RACDisposable : NSObject</div><div class="line">@property (atomic, assign, getter = isDisposed, readonly) BOOL disposed;</div><div class="line">+ (instancetype)disposableWithBlock:(void (^)(void))block;</div><div class="line">- (void)dispose;</div><div class="line">@end</div><div class="line"></div><div class="line">//RACDisposable:生命周期</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@1];</div><div class="line">    [RACScheduler.mainThreadScheduler afterDelay:2 schedule:^&#123;</div><div class="line">        [subscriber sendNext:@2];</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return [RACDisposable disposableWithBlock:^&#123;</div><div class="line">        NSLog(@&quot;dispose!!!&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">RACDisposable *disposable = [signal subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;next: %@&quot;, x);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;complete&quot;);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">[RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">    [disposable dispose];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//RACDisposable:block的作用</div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@1];</div><div class="line">    RACDisposable *disposable1 = [RACScheduler.mainThreadScheduler afterDelay:2 schedule:^&#123;</div><div class="line">        [subscriber sendNext:@2];</div><div class="line">    &#125;];</div><div class="line">    RACDisposable *disposable2 = [RACScheduler.mainThreadScheduler afterDelay:2 schedule:^&#123;</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return [RACDisposable disposableWithBlock:^&#123;</div><div class="line">        [disposable1 dispose];</div><div class="line">        [disposable2 dispose];</div><div class="line">        NSLog(@&quot;dispose!!!&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">RACDisposable *disposable = [signal subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;next: %@&quot;, x);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;complete&quot;);</div><div class="line">&#125;];</div><div class="line"></div><div class="line">[RACScheduler.mainThreadScheduler afterDelay:1 schedule:^&#123;</div><div class="line">    [disposable dispose];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//RACDisposable家族成员一:RACScopedDisposable绑定对象生存期的disposable</div><div class="line"></div><div class="line">+ (instancetype)scopedDisposableWithDisposable:(RACDisposable *)disposable;</div><div class="line">- (RACScopedDisposable *)asScopedDisposable;</div><div class="line"></div><div class="line">RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    [subscriber sendNext:@1];</div><div class="line">    RACDisposable *disposable1 = [RACScheduler.mainThreadScheduler afterDelay:2 schedule:^&#123;</div><div class="line">        [subscriber sendNext:@2];</div><div class="line">    &#125;];</div><div class="line">    RACDisposable *disposable2 = [RACScheduler.mainThreadScheduler afterDelay:2 schedule:^&#123;</div><div class="line">        [subscriber sendCompleted];</div><div class="line">    &#125;];</div><div class="line">    return [RACDisposable disposableWithBlock:^&#123;</div><div class="line">        [disposable1 dispose];</div><div class="line">        [disposable2 dispose];</div><div class="line">        NSLog(@&quot;dispose!!!&quot;);</div><div class="line">    &#125;];</div><div class="line">&#125;];</div><div class="line">RACDisposable *disposable = [signal subscribeNext:^(id x) &#123;</div><div class="line">    NSLog(@&quot;next: %@&quot;, x);</div><div class="line">&#125; completed:^&#123;</div><div class="line">    NSLog(@&quot;complete&quot;);</div><div class="line">&#125;];</div><div class="line">self.someProp = disposable.asScopedDisposable;</div><div class="line"></div><div class="line">//RACDisposable家族成员一:RACSerialDisposable可替换的disposable包裹</div><div class="line"></div><div class="line">+ (instancetype)serialDisposableWithDisposable:(RACDisposable *)disposable;</div><div class="line">@property (atomic, strong) RACDisposable *disposable;</div><div class="line"></div><div class="line">- (RACSignal *)myConcat:(RACSignal *)signal</div><div class="line">&#123;</div><div class="line">    return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">    RACSerialDisposable *mainDisposable = [[RACSerialDisposable alloc] init];</div><div class="line">    mainDisposable.disposable = [self subscribeNext:^(id x) &#123;</div><div class="line">            [subscriber sendNext:x];</div><div class="line">        &#125; error:^(NSError *error) &#123;</div><div class="line">            [subscriber sendError:error];</div><div class="line">        &#125; completed:^&#123;</div><div class="line">            mainDisposable.disposable = [signal subscribe:subscriber];</div><div class="line">        &#125;];</div><div class="line">        return mainDisposable;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">家族成员一:RACSerialDisposable多个disposable的包裹</div><div class="line"></div><div class="line">- (void)addDisposable:(RACDisposable *)disposable;</div><div class="line">- (void)removeDisposable:(RACDisposable *)disposable;</div><div class="line"></div><div class="line">+ (RACSignal *)myMerge:(id&lt;NSFastEnumeration&gt;)signals</div><div class="line">&#123;</div><div class="line">    return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123;</div><div class="line">        RACCompoundDisposable *mainDisposable = [[RACCompoundDisposable alloc] init];</div><div class="line">        for (RACSignal *signal in signals) &#123;</div><div class="line">            [mainDisposable addDisposable:[signal subscribeNext:^(id x) &#123;</div><div class="line">                [subscriber sendNext:x];</div><div class="line">            &#125; error:^(NSError *error) &#123;</div><div class="line">                [subscriber sendError:error];</div><div class="line">                [mainDisposable dispose];</div><div class="line">            &#125; completed:^&#123;</div><div class="line">                [subscriber sendCompleted];</div><div class="line">                [mainDisposable dispose];</div><div class="line">            &#125;]];</div><div class="line">        &#125;</div><div class="line">        return mainDisposable;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">ReactiveCocoa之实战演练</div><div class="line">FRP概论！简单变换、组合高阶函数！冷热信号！并发编程！生命周期与订阅销毁！RACChannel！</div><div class="line">RACCommand作用？</div><div class="line">重复执行一个过程！开关控制！防重入！错误异常的处理！结果统一处理！</div><div class="line">RACChannel作用?</div><div class="line">双向通道！类似通话！处理回声问题！</div><div class="line">RAC的循环引用问题？</div><div class="line">RAC中如何识别判断循环引用！如何解决循环引用！破除循环引用的一端！避免构造循环引用</div><div class="line">常见情况分析？</div><div class="line">strong指针可能会引起循环引！weak指针不会引起循环引！block持有self != 循环引！block对捕获的strong指针会进行引用！block对捕获的weak指针不会进行引用</div><div class="line">Weakify &amp; Strongify的使用说明？1、必须成对使用否则无效2、不只是用于self，也可用于其他变量3、必须在使用前@strongify，否则无效4、可以同时处理多个对象@weakify(a, b, c)</div><div class="line">循环引用的多种情况解析？1、信号创建时引起的循环引2、信号订阅时引起的循环引3、block嵌套时加几个strongify</div><div class="line">RAC宏的使用？</div><div class="line">RAC(self, a.b) vs RAC(self.a, b)的区别？1、被绑定的对象2、间接属性变化3、建议使用RAC(self, a.b)</div><div class="line">取消RAC的宏绑定？1、重复绑定会抛异常2、takeUntil取消绑定3、使用展开式,调用方法</div><div class="line">RACObserve(self, a.b) vs RACObserve(self.a, b)1、被监听的对象2、间接属性变化3、建议使用RACObserve(self, a.b)</div><div class="line">适合RAC的情景？1、异步场景，异步处理需求、处理成功subscribeNext、处理异常和错误subscribeError 2、事件处理。UI事件、Delegate 3、切面处理。KVO</div><div class="line">什么样的功能适合RAC！让OOP与FRP配合使！从FRP的叫度来分析问题！RAC使用小技巧</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/09/线程管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Carden007">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://static.pexels.com/photos/33392/portrait-bird-nature-wild.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Carden's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/09/线程管理/" itemprop="url">线程管理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-06-09T12:16:21+08:00">
                2017-06-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>#术语</p>
</blockquote>
<p><strong>任务</strong>：准备执行的操作，通常就是一个block块</p>
<p><strong>队列</strong>：queue，存放任务，管理任务</p>
<p><strong>进程</strong>——苹果电脑里的活动监视器App里详细罗列了操作系统此时此刻正在运行的所有程序，同时标明了每一个进行的程序的所有线程。</p>
<p><strong>线程</strong>——将一个程序都转换成汇编的CPU命令时，由一堆不分叉的Cpu指令组成的路径（主线程命令和分线程命令）</p>
<p><strong>多线程编程</strong>——由多条不分叉的CPU指令所组成的路径就是多线程编程。优点：提高资源利用率和程序执行效率，用户体验    缺点：1、上下文切换频率太高会影响性能 2、资源竞争—&gt;上锁（类似单例）3、死锁  4、开辟的线程其实类似于创建一个对象，会消耗大量内存（内核数据结构（大约1KB）、栈空间（子线程512KB、主线程1MB，也可以使用-setStackSize:设置，但必须是4K的倍数，而且最小是16K），创建线程大约需要90毫秒的创建时间）5、程序设计更加复杂：比如线程之间的通信、多线程的数据共享</p>
<p><strong>CPU包括</strong>——1、物理CPU（硬件）2、CPU核 （一个物理CPU可以虚拟出多个CPU核，一个CPU核就相当于一个CPU的功能，可以分身，一个CPU核一个时刻只能执行一个CPU命令）</p>
<p><strong>并发</strong>——虽然同一时间，CPU只能处理1条线程，只有1条线程在执行，但是CPU可以快速地在多条线程之间调度切换，如果CPU调度线程的时间足够快，就造成了多线程并发执行的假象。当然如果线程过多，会消耗大量的CPU资源，同时每条线程被调度执行的频次会降低（线程的执行效率降低）</p>
<blockquote>
<p>#多核就快</p>
</blockquote>
<p>首先谈一谈就是程序执行的本质，我们写的代码都首先是转化成一行行的汇编代码才能被计算机所识别。这一行行的汇编代码其实也叫做CPU指令。这里面就涉及到CPU了，CPU就是读取这些指令的工具。当然，有一种汇编代码也就是CPU指令的结构是从头到尾不间断的，也就是这些CPU指令一点也没有分叉，从头到尾都是直路，就像高速公路一样，只有直路，没有岔路。可是程序的魅力就在于，遇到分岔路时或更复杂的十字路口时应该怎么办？肯定不能一根筋呀！于是CPU厂商就想到了一个方法，就是分身术，当遇到分叉路的时候就像孙悟空一样，复制一个自己来走新出现的分岔路。可是问题来了，如果第二次又遇到分叉路怎么办呢？两种思路，第一种再复制一个自己。第二种就是用那个复制的自己轮流前进。第一种方法主要受到CPU本身性能的局限。有的CPU只能复制一个自己，算上本身总共才两个。也有的CPU可以复制三个自己，算上本身总共有4个。这种具体去跑马路的车就叫做CPU核，所以你会发现，CPU越强大，也就是能够复制的自己越多，能够同时走的分叉路就越多，自然而然，四核就是比双核快。第二种方法就是让CPU的寄存器不断受到考验，当CPU分配那个复制的自己在那一条道路上奔跑时，必须时时记录下来这个复制的自己已经在每一条分叉路上已经跑了多远，并需要准确无误的保存在寄存器中，然后当CPU再一次将那个复制的自己放在相应地分岔路上继续跑时，就会读取寄存器里面的数据来继续前进。</p>
<blockquote>
<p>#主线程刷UI</p>
</blockquote>
<p>因为分线程不能刷新UI，但是有的时候明明看见刷新UI的代码写在了分线程里，但这并不代表这些代码会被分线程（复制的CPU核）执行，分线程主要是负责数据的下载。（两种情况：1、下载完成后主动回到主线程，告诉主线程自己已经完成下载，可以让主线程执行分线程没有资格执行的代码 2、需要主线程不定期去主动检查也就是说,尽管你把刷新UI的代码写在了分线程，但分线程只会执行其中的下载代码，根本不会执行刷新UI的代码。刷新UI的代码会等到主线程不定期的主动检查分线程时才会被执行。所以这样会出现一些延时，所以应该在下载完成后主动回到主线程）</p>
<blockquote>
<p>#时间片</p>
</blockquote>
<p>如果同一个CPU核去管理多个线程时，就会涉及到时间分配的问题，如果管理的是两个线程，线程一有10个命令，线程二有20个命令，CPU核会将时间片分配给两个线程，一一去执行完两个线程里面的所有命令，当一个线程切换到另一个线程时，系统会将当前线程的信息保存到寄存器中，等下次切换过来到时候唤醒寄存器，读取数据，从上一次的命令接着处理。这就是上下文切换。上下文切换——时间片分配（随机分配CPU核给那一个分线程，同时保存每一分线程上一次执行到的位置到寄存器中，告诉CPU核现在该从第几个CPU指令开始执行）</p>
<p><img src="http://upload-images.jianshu.io/upload_images/645301-c79b90a8b2e8224e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS多线程"></p>
<blockquote>
<p>#NSThread</p>
</blockquote>
<ul>
<li>创建、启动线程</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];</div><div class="line">[thread start];</div></pre></td></tr></table></figure>
<ul>
<li>线程相关用法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">// 获得当前线程</div><div class="line">NSThread *current = [NSThread currentThread];</div><div class="line"></div><div class="line">// 线程名字</div><div class="line">- (void)setName:(NSString *)name;</div><div class="line">- (NSString *)name;</div><div class="line"></div><div class="line">// 获得主线程</div><div class="line">+ (NSThread *)mainThread; </div><div class="line"></div><div class="line">// 判断是否主线程</div><div class="line">- (BOOL)isMainThread; </div><div class="line">+ (BOOL)isMainThread;</div><div class="line"></div><div class="line">// 创建线程后自动启动</div><div class="line">[NSThread detachNewThreadSelector:@selector(run) toTarget:self withObject:nil];</div><div class="line"></div><div class="line">// 隐式创建并启动线程</div><div class="line">[self performSelectorInBackground:@selector(run)  withObject:nil];</div><div class="line"></div><div class="line">// 阻塞（暂停）线程</div><div class="line">+ (void)sleepUntilDate:(NSDate *)date;</div><div class="line">+ (void)sleepForTimeInterval:(NSTimeInterval)ti;</div><div class="line"></div><div class="line">// 强制停止线程</div><div class="line">+ (void)exit;</div></pre></td></tr></table></figure>
<blockquote>
<p>#GCD全称Grand Central Dispatch</p>
</blockquote>
<p>纯C语言函数，为多核并行运算而生，自动利用更多的CPU内核（比如双核、四核），且自动管理线程的生命周期（创建线程、调度任务、销毁线程），只需告诉GCD想要执行的任务，根本无需写任何管理线程生命周期的代码。队列管理任务执行顺序，同步异步决定任务执行线程。</p>
<ul>
<li>GCD创建并发队列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 创建并发队列（队列名称，队列类型）</div><div class="line">dispatch_queue_t   myQueue = dispatch_queue_create(const char *label,   dispatch_queue_attr_t attr);</div><div class="line"></div><div class="line">// 获得默认并发队列（队列优先级，缺省参数0）</div><div class="line">dispatch_queue_t  systemQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); </div><div class="line"></div><div class="line">// 任务加入并发队列</div><div class="line">dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;1-----%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;);</div><div class="line">dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;2-----%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;);</div><div class="line">dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;3-----%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>GCD创建串行队列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// 创建串行队列（队列名称，队列类型）</div><div class="line">dispatch_queue_t  myQueue = dispatch_queue_create(&quot;串行队列&quot;, DISPATCH_QUEUE_SERIAL)；</div><div class="line"></div><div class="line">// 直接获取主队列 = 特殊串行队列</div><div class="line">dispatch_queue_t  systemQueue = dispatch_get_main_queue();</div><div class="line"></div><div class="line">// 任务加入串行队列</div><div class="line">dispatch_sync(queue, ^&#123;</div><div class="line">        NSLog(@&quot;1-----%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;);</div><div class="line">dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;2-----%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;);</div><div class="line">dispatch_async(queue, ^&#123;</div><div class="line">        NSLog(@&quot;3-----%@&quot;, [NSThread currentThread]);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>GCD同步执行任务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 继续当前线程（队列，任务）</div><div class="line">dispatch_sync(dispatch_queue_t queue, dispatch_block_t block);</div></pre></td></tr></table></figure>
<ul>
<li>GCD异步执行任务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">// 开启新线程（队列，任务）</div><div class="line">dispatch_async(dispatch_queue_t queue, dispatch_block_t block);</div></pre></td></tr></table></figure>
<ul>
<li>GCD线程通信</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// 从子线程回到主线程</div><div class="line">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">                // 执行耗时的异步操作...</div><div class="line"></div><div class="line"></div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">               // 回到主线程，执行UI刷新操作</div><div class="line"></div><div class="line">         &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// 对比performSelector的线程通信</div><div class="line">- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(id)arg waitUntilDone:(BOOL)wait;</div><div class="line">- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(id)arg waitUntilDone:(BOOL)wait;</div></pre></td></tr></table></figure>
<ul>
<li>GCD延时执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// GCD延时</div><div class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">    // 2秒后异步执行这里的代码...</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// 对比performSelector延时</div><div class="line">[self performSelector:@selector(run) withObject:nil afterDelay:2.0];</div><div class="line"></div><div class="line">// 对比NSTimer延时</div><div class="line">[NSTimer scheduledTimerWithTimeInterval:2.0 target:self selector:@selector(test) userInfo:nil repeats:NO];</div></pre></td></tr></table></figure>
<ul>
<li>GCD单例执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// 保证某段代码在程序运行过程中只被执行1次</div><div class="line">static dispatch_once_t onceToken;</div><div class="line">dispatch_once(&amp;onceToken, ^&#123;</div><div class="line">    // 只执行1次的代码(这里面默认是线程安全的)</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>GCD创建定时器执行代码块</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">// 创建Timer</div><div class="line">self.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, dispatch_get_main_queue());</div><div class="line">// 设置定时器的触发时间（1秒后）和时间间隔（每隔2秒）</div><div class="line">dispatch_source_set_timer(self.timer, dispatch_time(DISPATCH_TIME_NOW, 1.0 * NSEC_PER_SEC), 2 * NSEC_PER_SEC, 0);</div><div class="line">// 设置Block回调</div><div class="line">dispatch_source_set_event_handler(self.timer, ^&#123;</div><div class="line">     NSLog(@&quot;Timer %@&quot;, [NSThread currentThread]);</div><div class="line">&#125;);</div><div class="line">// 开启定时器</div><div class="line">dispatch_resume(self.timer);</div><div class="line"></div><div class="line"></div><div class="line">// 取消置空定时器</div><div class="line">dispatch_cancel(self.timer);</div><div class="line">self.timer = nil;</div></pre></td></tr></table></figure>
<ul>
<li>GCD实现任务依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// 队列组管理任务一和任务二</div><div class="line">dispatch_group_t group =  dispatch_group_create();</div><div class="line"></div><div class="line">// 异步执行任务一</div><div class="line">dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">    </div><div class="line">&#125;);</div><div class="line"></div><div class="line">// 异步执行任务二</div><div class="line">dispatch_group_async(group, dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">   </div><div class="line">&#125;);</div><div class="line"></div><div class="line">// 任务一和任务二都结束Block回调</div><div class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^&#123;</div><div class="line">    </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>GCD分线程遍历</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> *   GCD快速异步遍历</div><div class="line"> */</div><div class="line">- (void)apply</div><div class="line">&#123;</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    NSString *from = @&quot;初始路径&quot;;</div><div class="line">    NSString *to = @目标路径&quot;;</div><div class="line">    </div><div class="line">    NSFileManager *mgr = [NSFileManager defaultManager];</div><div class="line">    NSArray *subpaths = [mgr subpathsAtPath:from];</div><div class="line">    </div><div class="line">    dispatch_apply(subpaths.count, queue, ^(size_t index) &#123;</div><div class="line">        NSString *subpath = subpaths[index];</div><div class="line">        NSString *fromFullpath = [from stringByAppendingPathComponent:subpath];</div><div class="line">        NSString *toFullpath = [to stringByAppendingPathComponent:subpath];</div><div class="line">        [mgr moveItemAtPath:fromFullpath toPath:toFullpath error:nil]; // 剪切</div><div class="line">        NSLog(@&quot;%@---%@&quot;, [NSThread currentThread], subpath);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">/**</div><div class="line"> *  对比传统异步遍历</div><div class="line"> */</div><div class="line">- (void)moveFile &#123;</div><div class="line">    NSString *from = @&quot;初始路径&quot;;</div><div class="line">    NSString *to = @目标路径&quot;;</div><div class="line"></div><div class="line">    NSFileManager *mgr = [NSFileManager defaultManager];</div><div class="line">    NSArray *subpaths = [mgr subpathsAtPath:from];</div><div class="line"></div><div class="line">    for (NSString *subpath in subpaths) &#123;</div><div class="line">        NSString *fromFullpath = [from stringByAppendingPathComponent:subpath];</div><div class="line">        NSString *toFullpath = [to stringByAppendingPathComponent:subpath];</div><div class="line"></div><div class="line">        dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123;</div><div class="line">            [mgr moveItemAtPath:fromFullpath toPath:toFullpath error:nil]; // 剪切</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>#NSOperation&amp;&amp;NSOperationQueue</p>
</blockquote>
<p>NSOperation是个并不具备封装操作能力的抽象类，必须使用它的子类来封装操作，NSOperation子类包括NSInvocationOperation、NSBlockOperation、自定义子类继承NSOperation。如果仅仅是实例化了一个操作对象，然后简简单单的执行这个操作的start方法，这样没有丝毫意义，还不如在.m文件里面写一个私有方法来得直接，可是一旦把实例化的NSOperation对象放到NSOperationQueue队列之中，添加到队列里面的操作对象会自动开始调用操作对象的start方法，开始异步在一条新的线程里面执行封装在操作对象里面的一系列代码，这就实现了分线程操作了，好神奇有木有！</p>
<ul>
<li>创建NSInvocationOperation操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//  创建NSInvocationOperation对象</div><div class="line">- (id)initWithTarget:(id)target selector:(SEL)sel object:(id)arg;</div><div class="line"></div><div class="line">//  默认同步，除非添加操作到队列</div><div class="line">- (void)addOperation:(NSOperation *)op;</div></pre></td></tr></table></figure>
<ul>
<li>创建NSBlockOperation操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//  创建NSBlockOperation</div><div class="line">+ (id)blockOperationWithBlock:(void (^)(void))block;</div><div class="line"></div><div class="line">//  添加更多操作（只要任务数&gt;1，就会异步执行操作）</div><div class="line">- (void)addExecutionBlock:(void (^)(void))block;</div></pre></td></tr></table></figure>
<ul>
<li>创建自定义NSOperation操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">重写父类NSOperation的main方法，在main方法里面写入我想要封装的执行的任务，但是有一点需要特别注意，就是自己写的这段代码很可能会是在子线程里面异步执行，既然是异步操作，自然无法访问主线程的自动释放池，对象的内存释放便是需要重点考虑的内容。经常的做法就是，在封装想要执行的代码之前，必须先判断一下这个操作对象是否已经被取消，因为一旦开始执行进入了子线程就无法在判断isCancelled这个属性了，所以必须在开始执行封装的代码之前，必须先判断这个操作对象是否已经被取消。如果判断已经取消，我需要做的就是一些内存的管理。</div></pre></td></tr></table></figure>
<ul>
<li>创建NSOperation操作依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// 一定先让操作A执行完毕，然后才能执行操作B</div><div class="line">[operationB addDependency:operationA]; </div><div class="line">！！！一定注意不能相互依赖</div></pre></td></tr></table></figure>
<ul>
<li>监听NSOperation操作执行完毕</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (void (^)(void))completionBlock;</div><div class="line">- (void)setCompletionBlock:(void (^)(void))block;</div></pre></td></tr></table></figure>
<ul>
<li>添加操作到NSOperationQueue对列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (void)addOperation:(NSOperation *)op;</div><div class="line">- (void)addOperationWithBlock:(void (^)(void))block;</div></pre></td></tr></table></figure>
<ul>
<li>设置操作对列NSOperationQueue最大并发数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (NSInteger)maxConcurrentOperationCount;</div><div class="line">- (void)setMaxConcurrentOperationCount:(NSInteger)cnt;</div></pre></td></tr></table></figure>
<ul>
<li>对列NSOperationQueue的取消、暂停、恢复</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//  取消队列操作</div><div class="line">- (void)cancelAllOperations;</div><div class="line">- (void)cancel；</div><div class="line"></div><div class="line">// 暂停Or恢复队列</div><div class="line">- (void)setSuspended:(BOOL)bool; </div><div class="line">- (BOOL)isSuspended;</div></pre></td></tr></table></figure>
<blockquote>
<p>#GCD和NSOperation的区别？</p>
</blockquote>
<p>GCD无法控制线程的最大并发数，而NSOperation可以控制同时进行的线程个数！</p>
<blockquote>
<p>#开辟多线程？</p>
</blockquote>
<ul>
<li><strong>performSelector</strong></li>
</ul>
<p>作为<code>NSObject</code>的类别，因此只要是控制器的对象就可以直接调用这个方法。而且不仅仅可以通过<code>performSelectorInBackground</code>将耗时操作放进分线程里，更可以通过<code>performSelectorOnMainThread</code>将分线程里的参数传递到主线程以便进一步操作，例如刷新<code>UI</code>。</p>
<ul>
<li><strong>NSThread线程类</strong></li>
</ul>
<p><code>thread</code>本身就是线的意思。通过<code>NSThread</code>类实例化一个对象。然后直接通过初始化方法就可以像为<code>UIButton</code>增添点击事件那样增添一个在分线程里进行的方法。而且可以传递给这个分线程方法一个无论什么对象类型的参数。但是特别注意：通过<code>NSThread</code>类实例化的对象所初始化增添的分线程方法必须通过[对象 start]方法表示开始执行分线程方法。而且无论第三方工具如何丰富，本质上都是对<code>NSThread</code>进行一系列操作。所以说在任何情况下都可以调用<code>[NSThread currentThread]</code>这个类方法获取到当前的线程信息，有点像代码版的活动监视器哈！这是苹果提供的三种方法里面相对轻量级的，但需要管理线程的生命周期、同步、加锁的问题，这会导致一定得性能开销。</p>
<ul>
<li><strong>GCD队列Grand Central Dispatch</strong></li>
</ul>
<p>伟大的中枢调度器，充分发挥CPU内核的性能，自动管理线程的生命周期，包括创建线程，调度任务和销毁线程。而且使用过程中只需添加任务即可，无需管理线程。</p>
<ul>
<li><strong>NSOperation</strong></li>
</ul>
<p>一块资源可能会被多个线程共享，通常添加互斥锁<code>@synchronized(self){}</code>来避免引发数据错乱和数据安全问题。但是添加互斥锁会影响手机的性能，所以尽量将加锁和资源抢夺业务的逻辑交给服务器端处理，线程不会孤立存在，子线程下载图片，在主线程刷新UI显示图片。使用<code>@synchronized(self的锁对象){}</code>包起来的代码同一时刻只能被一个线程执行，而且加锁的时候尽量缩小范围，范围越大就越消耗性能。</p>
<blockquote>
<p>#串行队列Vs并行队列？</p>
</blockquote>
<p><strong>相同点</strong>：</p>
<ul>
<li><p>创建方式都是<code>dispatch_queue_t queue</code>，只不过创建队列时的标志符后面的参数有了一些变化，主要有<code>（NULL， DISPATCH_QUEUE_SERIAL，DISPATCH_QUEUE_CONCURRENT）</code>三种类型。前两种等价都可以表示串行队列。而且有一个细节就是标识符的格式是否有要求一时确定不了！</p>
</li>
<li><p>往队列里添加任务的方式一模一样，都是<code>dispatch_async(queue, ^{})</code>这种格式。凡是创建的队列都是以分线程的形式存在。所以对于一个分线程队列来说就必须考虑如何返回到主线程。而且这也不是说纯粹意义上的将这个分线程注销，更多的是想将无法在分线程中执行的代码及时的传递到主线程以便进行下一步操作。</p>
</li>
<li><p>将分线程中下载完成的数据如何让以参数的形式传递到主线程呢？两种方法，方法1就是使用控制器的对象调用<code>performSelectorOnMainThread</code>方法。方法2就是通过<code>dispatch_queue_t mainQueue = dispatch_get_main_queue()</code>获取到主队列，这也就代表了主线程。通过在主队列中添加任务也就等于是通过主线程来执行分线程无法执行的代码。而且方法2还有一个优点就是，无需像方法一那样过于纠结于到底应该将分线程的什么参数传递出去，因为方法二是直接建立在分线程的基础上，本质上只是起一个临时调用主线程的功能，因此方法二可以直接调用分线程里的任何参数变量。</p>
</li>
<li><p>如果不理解什么是串行队列，其实主队列<code>dispatch_queue_t mainQueue = dispatch_get_main_queue()</code>就是一个典型的串行队列，无论你添加多少任务总是按照任务的添加顺序依次执行，没有例外。而且自始至终都是一个线程，而且这个线程就叫做主线程。</p>
</li>
</ul>
<p><strong>不同点</strong>：</p>
<ul>
<li><p>串行队列无论添加多少个任务都只是创建了一个分线程，而且执行任务的顺序严格按照添加任务的先后顺序进行。而对于并行队列而言，往并行对列中每增添一个任务就创建了一个分线程。也就是说并行队列中有多少个任务就有多少个分线程，我们也都知道，线程其实本质上也是一个对象，是对象就必须开辟内存，因此虽然说创建很多的分线程有利于获得良好的用户体验，但这对于用户终端的内存是一个极大的考验。</p>
</li>
<li><p>并行队列的任务因为是一个任务对应一个分线程。所以可以认为并行队列里的任务是同时进行的。所以最终并行队列里的哪一个任务最先执行结束的关键还在于任务的具体内容。</p>
</li>
<li><p>对于并行队列而言有一种很特殊的需求就是：我想准确地知道并行队列里的最后一个任务是什么时候执行完毕，然后我再进行下一部操作，因为通常情况下是无法准确地获取到现在并行队列的任务到底执行到了一个什么阶段。根本无法像串行队列那样通过添加任务的先后顺序来推断出到底哪一个任务结束后标志着队列任务全部结束！解决方案就是给并行队列添加一个<code>group</code>。同样需要通过<code>dispatch_queue_t  queue = dispatch_queue_create(&quot;123&quot;, DISPATCH_QUEUE_CONCURRENT)</code>先创建一个并行队列，然后通过<code>dispatch_group_t group = dispatch_group_create()</code>创建一个管理并行队列里所有任务的组。接着跟常规添加任务到并行队列不同的是：<code>dispatch_group_async(group, queue, ^{});</code>当然从分线程返回到主线程的方法<code>dispatch_async(dispatch_get_main_queue(), ^{});</code>并没有发生变化。把所有的任务添加到有管理组的并行队列中目的就是时刻监听并行队列里的任务的进行阶段，监听到并行队列里所有的任务全部结束时就会触发方法<code>dispatch_group_notify(group,dispatch_get_main_queue(),^{});</code>需要注意的是，这个方法里面的代码全部是由主线程执行。因为并行队列里的所有任务所对应的分线程也已经结束。监听到任务结束自动将监听方法里面的代码交由主线程执行。这也就是说，其实管理并行队列里所有任务的组<code>group</code>的监听方法其实本质上就是就是并行队列里所有任务都结束后返回到主线程以便进行下一步操作。</p>
</li>
<li><p>如果我们想要创建多个并行对列，那么又如何确定哪一个并行队列率先执行呢，答案是，根据并行队列的优先级来进行判断。创建有优先级的并行队列的方法为dispatch_queue_t queue1 = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0)。当然在这里将并行队列的优先级设置为了默认，也就相当于又增加了一种创建普通并行队列的方法。</p>
</li>
<li><p>如果我想队列里的任务在多少秒之后才开始执行，那么最简单的方法就是在具体的任务里添加睡眠延时<code>sleep(1)</code>，但是的但是这也仅仅适用于串行队列中，而且就算这样可以也会带来一个整体任务进行的延时。对于并行队列来说，只要添加完了任务就会全面开始，根本不会停下来，所以最好的方法就是通过<code>dispatch_time_t  time = dispatch_time(DISPATCH_TIME_NOW, 4ull*NSEC_PER_MSEC)</code>来设置过4秒后再通过<code>dispatch_after(time, queue, ^{})</code>将任务添加到队列<code>queue</code>中。这样就可以完美的实现至少在多少秒后再进行某一个任务。6、无论在串行队列还是在并行队列中，有时候我们想要某个任务只进行一次，就算这是一个死循环的队列，也要保证某个任务只被执行一次，方法就是先用<code>static  dispatch_once_t  onceTaken</code>确定谓词<code>onceTaken</code> ，用来保证<code>dispatch_once(&amp;onceTaken,^{ })</code>方法里的代码也就是任务将从始至终只会被执行一次。</p>
</li>
</ul>
<blockquote>
<p>#互斥锁</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">@synchronized(锁对象) &#123; // 需要锁定的代码  &#125;</div><div class="line"></div><div class="line">static id _instance;</div><div class="line">+ (instancetype)allocWithZone:(struct _NSZone *)zone</div><div class="line">&#123;</div><div class="line">    @synchronized(self) &#123;</div><div class="line">        if (_instance == nil) &#123;</div><div class="line">            _instance = [super allocWithZone:zone];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return _instance;</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (instancetype)sharedInstance</div><div class="line">&#123;</div><div class="line">    @synchronized(self) &#123;</div><div class="line">        if (_instance == nil) &#123;</div><div class="line">            _instance = [[self alloc] init];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return _instance;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (id)copyWithZone:(NSZone *)zone</div><div class="line">&#123;</div><div class="line">    return _instance;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>优点：能有效防止因多线程抢夺资源造成的数据安全问题<br>缺点：需要消耗大量的CPU资源<br>前提：多条线程抢夺同一块资源<br>线程同步：多条线程在同一条线上执行（按顺序地执行任务）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">atomic：原子属性，为setter方法加锁（默认就是atomic），线程安全，需要消耗大量的资源</div><div class="line">nonatomic：非原子属性，不会为setter方法加锁，非线程安全，适合内存小的移动设备，尽量避免多线程抢夺同一块资源，尽量将加锁、资源抢夺的业务逻辑交给服务器端处理，减小移动客户端的压力</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://static.pexels.com/photos/33392/portrait-bird-nature-wild.jpg"
               alt="Carden007" />
          <p class="site-author-name" itemprop="name">Carden007</p>
           
              <p class="site-description motion-element" itemprop="description">人生有很多事情急不得，没有白走的路，走每一步都算数。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Carden007</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
